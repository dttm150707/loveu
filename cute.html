<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Mini Game Cho NgÆ°á»i Tui ThÆ°Æ¡ng</title>
<style>
body{
  margin:0;font-family:Arial;
  background:linear-gradient(135deg,#ffdde1,#ee9ca7);
  text-align:center;
}
.screen{display:none;padding:20px}
.active{display:block}
.box{
  background:#fff;border-radius:20px;
  padding:20px;max-width:420px;
  margin:30px auto;
  box-shadow:0 10px 25px rgba(0,0,0,.2)
}
button{
  padding:10px 15px;border:none;
  border-radius:12px;margin:6px;
  background:#ffb6c1;cursor:pointer
}
.music-btn{
  position:fixed;top:15px;right:15px;
  width:46px;height:46px;border-radius:50%;
  background:#ff5e7e;color:#fff;font-size:18px
}
canvas{border-radius:15px}
.scratch-card {
  position: relative;
  width: 260px;
  height: 160px;
  margin: auto;
}

.reward {
  position: absolute;
  inset: 0;
  z-index: 1;
  display: flex;
  align-items: center;
  justify-content: center;
}

canvas#scratch {
  position: absolute;
  inset: 0;
  z-index: 2;
}
#reward img{
  max-width: 100%;
  max-height: 220px;
  object-fit: contain;
  display: block;
  margin: 10px auto;
}
#reward{
  max-height: 360px;
  overflow-y: auto;
}

.hidden {
  visibility: hidden;
}
</style>
</head>

<body>

<audio id="bgm" loop>
  <source src="music.mp3" type="audio/mpeg">
</audio>
<button class="music-btn" onclick="toggleMusic()">ğŸµ</button>

<!-- QUIZ -->
<div id="quiz" class="screen active box">
  <h2 id="question"></h2>
  <div id="answers"></div>
</div>

<!-- RESULT -->
<div id="result" class="screen box">
  <h3>Tá»•ng Ä‘iá»ƒm: <span id="score"></span></h3>
  <p>Sá»‘ lÆ°á»£t quay: <span id="spins"></span></p>
  <button onclick="startSpin()">Báº¯t Ä‘áº§u ğŸ¡</button>
</div>

<!-- WHEEL -->
<div id="wheelScreen" class="screen box">
  <h3>VÃ²ng quay may máº¯n</h3>
  <canvas id="wheel" width="260" height="260"></canvas>
  <p>LÆ°á»£t cÃ²n láº¡i: <span id="spinLeft"></span></p>
  <button onclick="spin()">Quay</button>
</div>

<!-- SCRATCH -->
<div id="scratchScreen" class="screen box">
  <h3>CÃ o quÃ  ğŸ</h3>
  <div class="scratch-card">
  <div id="reward" class="reward hidden"></div>
  <canvas id="scratch" width="260" height="160"></canvas>
 </div>
  <button onclick="backToWheel()">Quay tiáº¿p</button>
</div>

<script>
/* MUSIC */
let playing=false;
function toggleMusic(){
 const m=bgm; playing?m.pause():m.play(); playing=!playing;
}

/* QUIZ */
const questions=[
 "Em cÃ³ nhá»› láº§n Ä‘áº§u hai Ä‘á»©a nÃ³i chuyá»‡n khÃ´ng?",
 "Em tháº¥y tui quan trá»ng khÃ´ng?",
 "Náº¿u pháº£i chá»n, em cÃ³ chá»n tui khÃ´ng?",
 "á» bÃªn tui em cÃ³ vui khÃ´ng?",
 "Em nghÄ© vá» tui nhiá»u khÃ´ng?",
 "Em cÃ³ tin vÃ o duyÃªn khÃ´ng?",
 "Náº¿u tui buá»“n, em cÃ³ á»Ÿ láº¡i khÃ´ng?",
 "Em cÃ³ thÃ­ch máº¥y Ä‘iá»u nhá» tui lÃ m khÃ´ng?",
 "Em cÃ³ muá»‘n Ä‘i cÃ¹ng tui lÃ¢u hÆ¡n khÃ´ng?",
 "Em cÃ³ thÆ°Æ¡ng tui khÃ´ng?"
];
const answers=[
 {t:"Ráº¥t cÃ³",p:4},{t:"CÃ³",p:3},
 {t:"BÃ¬nh thÆ°á»ng",p:2},{t:"KhÃ´ng",p:1}
];
let qi=0,total=0;

function loadQ(){
 question.innerText=questions[qi];
 answersBox.innerHTML="";
 answers.forEach(a=>{
  let b=document.createElement("button");
  b.innerText=a.t;
  b.onclick=()=>{
    total+=a.p;qi++;
    qi<questions.length?loadQ():showResult();
  };
  answersBox.appendChild(b);
 });
}
const answersBox=document.getElementById("answers");
loadQ();

/* RESULT */
function showResult(){
 show("result");
 score.innerText=total;
 spins.innerText=total;
}

/* WHEEL */
let spinsLeft,angle=0;
const slots=[
 "gift","gift","gift","gift","gift","gift",
 "gift","gift","gift","gift","gift","gift",
 "miss","miss"
];
const wheelCtx=document.getElementById("wheel").getContext("2d");

function drawWheel(){
 const n=slots.length,step=2*Math.PI/n;
 wheelCtx.clearRect(0,0,260,260);
 for(let i=0;i<n;i++){
  wheelCtx.beginPath();
  wheelCtx.moveTo(130,130);
  wheelCtx.arc(130,130,130,angle+i*step,angle+(i+1)*step);
  wheelCtx.fillStyle=i%2?"#ffd1dc":"#ff9eb5";
  wheelCtx.fill();
 }
}
drawWheel();

function startSpin(){
 spinsLeft=total;
 spinLeft.innerText=spinsLeft;
 show("wheelScreen");
}

function spin(){
 if(spinsLeft<=0)return alert("Háº¿t lÆ°á»£t rá»“i");
 spinsLeft--;spinLeft.innerText=spinsLeft;
 let t=0,spinInt=setInterval(()=>{
  angle+=0.3;drawWheel();t++;
  if(t>30){
    clearInterval(spinInt);
    const index=Math.floor(Math.random()*slots.length);
    slots[index]==="gift"?showReward():alert("ChÃºc may máº¯n láº§n sau");
  }
 },30);
}

/* SCRATCH */
const rewards=[
 "<img src='https://i.postimg.cc/NFH9BcK8/70d1cc0f-11f6-43bb-9a95-5eb1094f79f4.jpg' width='260'>",
 "<img src='https://i.postimg.cc/6p9LKMXq/8fdfca70-266f-483c-ae49-5e7c60db1303.jpg' width='260'>",
 "<img src='https://i.postimg.cc/gcVZ034X/57595901-b3ac-45c3-8d86-e7bab104bdeb.jpg' width='260'>",
 "<img src='https://i.postimg.cc/7hwbzQXD/0cb54b55-3af0-4a19-bfb1-4429781c0cf8.jpg' width='260'>",
 "<img src='https://i.postimg.cc/zGg5JFSd/caa38cee-fb67-4b15-bbcd-36a366b969f0.jpg' width='260'>",
 "<img src='https://i.postimg.cc/6Q6XdxxM/2b227bcc-b9a7-4a58-bbb7-25ae66549192.jpg' width='260'>",
 "<img src='https://i.postimg.cc/QN1yxYRb/48e2543c-c20d-4749-bf79-d6c8c61decac.jpg' width='260'>",
 "<p>ChÃºc má»«ng em nháº­n Ä‘Æ°á»£c mÃ³n quÃ  bÃ­ máº­t tá»« tui, Ä‘Æ¡n giáº£n nhÆ°ng lÃ  tÃ¢m huyáº¿t cá»§a tui dÃ nh cho vá»£ â¤ï¸ cÃ³ thá»ƒ nÃ³ khÃ´ng hoÃ n háº£o nhÆ°ng tui mong em sáº½ cÆ°á»i khi Ä‘á»c nhá»¯ng dÃ²ng nÃ y, vÃ  dÃ¹ dá»‹p nÃ y chÃºng ta chÆ°a thá»ƒ á»Ÿ bÃªn nhau má»™t cÃ¡ch trá»n váº¹n nhÆ°ng mong ráº±ng nhá»¯ng ngÃ y tá»›i em sáº½ luÃ´n cÆ°á»i tháº­t xinh vÃ  sá»‘ng vÃ´ lo vÃ´ nghÄ© nhÆ° nhá»¯ng bÃ´ng hoa ğŸŒ».</p>",
 "<p>Cáº£m Æ¡n vÃ¬ em Ä‘Ã£ á»Ÿ Ä‘Ã¢y, cÃ¹ng tui tráº£i qua cÃ¡i táº¿t thá»© hai, cÃ¡i valentine thá»© hai, nhÆ°ng vá»›i tÆ° cÃ¡ch lÃ  ny chá»© khÃ´ng chá»‰ cÃ²n lÃ  báº¡n bÃ¨ ná»¯a.</p>",
 "<p>Chá»‰ mong cÃ³ thÃªm nhiá»u khoáº£nh kháº¯c cÃ¹ng em, cá»‘ gáº¯ng vÃ¬ nhau, vÃ¬ tÃ¬nh yÃªu vÃ  tÆ°Æ¡ng lai cá»§a hai chÃºng ta nhÃ© â¤ï¸ nÄƒm má»›i nÃ y hÃ£y cÃ¹ng nhau tháº¥u hiá»ƒu, cÃ¹ng nhau chia sáº», hÃ£y tha thá»© cho nhá»¯ng tÃ­nh xáº¥u cá»§a tui nha.</p>",
 "<p>Má»—i láº§n nghÄ© tá»›i em, tui Ä‘á»u má»‰m cÆ°á»i, cáº£m Æ¡n em Ä‘Ã£ xuáº¥t hiá»‡n trong cuá»™c sá»‘ng cá»§a tui, yÃªu tui vÃ  bao dung cho tÃ­nh Ä‘Ã¡ng ghÃ©t vÃ  tráº» con cá»§a tui ğŸ’— valentine vui váº», táº¿t vui váº», yÃªu em nhiá»uu.</p>",
 "<p>Hy vá»ng Ä‘iá»u tá»‘t Ä‘áº¹p luÃ´n tÃ¬m Ä‘Æ°á»£c em, hy vá»ng chÃºng ta sáº½ lÃ  ngÆ°á»i Ä‘áº§u tiÃªn cá»§a ngÆ°á»i kia, khÃ´ng pháº£i ngÆ°á»i Ä‘áº§u tiÃªn ta yÃªu nhÆ°ng sáº½ lÃ  ngÆ°á»i Ä‘áº§u tiÃªn ta Ã´m, ta náº¯m tay, vÃ  cÅ©ng lÃ  ngÆ°á»i cuá»‘i cÃ¹ng bÆ°á»›c Ä‘i cÃ¹ng nhau dÆ°á»›i má»™t báº§u trá»i â¤ï¸.</p>"
];

const scratchCanvas = document.getElementById("scratch");
const scratchCtx = scratchCanvas.getContext("2d");

let scratching = false;

function showReward(){
  show("scratchScreen");

  reward.classList.add("hidden");
  scratchCanvas.style.display = "block";

  reward.innerHTML = rewards[Math.floor(Math.random()*rewards.length)];

  scratchCtx.globalCompositeOperation = "source-over";
  scratchCtx.fillStyle = "#bbb";
  scratchCtx.fillRect(0,0,260,160);
  scratchCtx.globalCompositeOperation = "destination-out";
}
scratchCanvas.addEventListener("mousedown",()=>scratching=true);
scratchCanvas.addEventListener("mouseup",()=>{
  scratching=false;
  reward.classList.remove("hidden");
});
scratchCanvas.addEventListener("mousemove",e=>{
  if(!scratching) return;
  const rect = scratchCanvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  scratchCtx.beginPath();
  scratchCtx.arc(x,y,15,0,Math.PI*2);
  scratchCtx.fill();
});

function backToWheel(){show("wheelScreen");}

/* HELPER */
function show(id){
 document.querySelectorAll(".screen")
 .forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}
</script>
</body>
</html>
